# 变量

在 Lua 中，变量的创建和作用域管理相对简单。Lua 支持动态类型，即变量的数据类型是在运行时决定的。同时，变量默认是全局变量，除非使用 `local` 关键字来限定局部作用域。

## 1. **新建变量**
### 1.1 **变量赋值即创建变量**
在 Lua 中，通过赋值语句来创建一个变量，而不需要显式的声明。例如，直接使用赋值语句来创建一个变量并赋值。

```lua
x = 10  -- 创建了一个全局变量 x，并赋值为 10
print(x)  -- 输出: 10
```

### 1.2 **默认全局变量**
在 Lua 中，所有未使用 `local` 关键字声明的变量默认是全局变量。这意味着它们在程序的任何地方都是可访问和修改的。全局变量存在于全局环境中，即它们是全局表的一部分。

```lua
y = 20  -- 创建了一个全局变量 y
print(y)  -- 输出: 20
```

### 1.3 **局部变量**
使用 `local` 关键字来声明一个局部变量。局部变量的作用域通常限于其所在的代码块、函数或控制结构（如循环、条件语句等）。局部变量不会污染全局命名空间，避免了全局命名冲突。

```lua
local z = 30  -- 创建了一个局部变量 z
print(z)  -- 输出: 30
```

局部变量是有限制的，它们只在其定义的块（如函数、循环、if 语句等）内有效。

```lua
local x = 5
if x == 5 then
    local y = 10  -- y 只在 if 语句内有效
    print(y)  -- 输出: 10
end
-- print(y)  -- 错误，y 是局部变量，无法在外部访问
```

## 2. **变量作用域**
### 2.1 **全局作用域**
默认情况下，Lua 变量是全局的，这意味着它们在程序的任何地方都是有效的，直到程序结束为止。全局变量可以在任何地方修改和访问。

```lua
a = 100  -- 全局变量
function test()
    print(a)  -- 访问全局变量 a
end
test()  -- 输出: 100
```

### 2.2 **局部作用域**
使用 `local` 声明的变量是局部的，只在其声明的块或函数中有效。局部变量不会影响外部代码，避免了全局变量冲突的问题。

```lua
function example()
    local b = 200  -- 局部变量 b
    print(b)  -- 输出: 200
end
example()
-- print(b)  -- 错误，b 是局部变量，无法在外部访问
```

### 2.3 **局部变量在循环中的作用域**
局部变量的作用域还可以限定在控制结构内，如 `for` 循环、`while` 循环等。

```lua
for i = 1, 5 do
    local loop_var = i  -- 局部变量，只在循环体内有效
    print(loop_var)
end
-- print(loop_var)  -- 错误，loop_var 只在 for 循环内部有效
```

## 3. **变量生命周期**
- **全局变量** 在程序的整个生命周期内存在，直到程序结束时才会被垃圾回收。
- **局部变量** 只在它们的作用域（如函数、循环等）内有效，一旦作用域结束，局部变量就会被销毁，释放内存。

## 4. **变量的初始值**
- **全局变量** 在未赋值时默认为 `nil`，因此访问未初始化的全局变量时会返回 `nil`。
- **局部变量** 也会默认为 `nil`，如果在声明时没有赋值。

```lua
local x  -- 局部变量 x，默认为 nil
print(x)  -- 输出: nil
```

### 4.1 **初始化局部变量**
为了避免局部变量不小心引用 `nil` 值，通常会在定义时给局部变量赋一个默认值：

```lua
local count = 0  -- 局部变量，初始化为 0
print(count)  -- 输出: 0
```

## 5. **全局与局部变量命名空间**
- **全局变量** 存在于全局命名空间（全局表）中。全局变量可以通过名称直接访问，并且可能与其他库或模块中的名称冲突。
- **局部变量** 存在于它们定义的作用域内，不会影响全局命名空间。

为了避免命名冲突，建议尽量使用局部变量，并且在全局作用域中使用有意义的名称，避免使用常见的名称。

## 6. **常量**
Lua 不支持原生的常量声明机制。然而，你可以通过局部变量来模拟常量。

```lua
local PI = 3.14159  -- 模拟常量 PI
-- PI = 3.14  -- 不建议修改常量的值
print(PI)  -- 输出: 3.14159
```

---

### 7. **总结**

- 在 Lua 中，变量通过赋值来创建，默认情况下所有变量是全局的。
- 使用 `local` 关键字可以创建局部变量，限定变量的作用域。
- 局部变量在其作用域内有效，而全局变量在整个程序运行期间有效。
- 应尽量避免使用全局变量，尤其在较大的程序中，以减少命名冲突和提高代码的可维护性。

---
